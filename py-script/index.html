<!DOCTYPE html>
<html>
  <head>
    <title>py-script</title>
    <meta charset="utf-8">
    <link rel="stylesheet" href="https://pyscript.net/latest/pyscript.css" />
    <script defer src="https://pyscript.net/latest/pyscript.js"></script>
  </head>
    <py-config>
    </py-config>
    <input id="add-ticker" />
    <button py-click="func()" id="ticker-btn" class="py-button">Go!</button>
    <div id="output"></div>
    <py-script>
      user_input = Element("add-ticker")
      container = Element("output")
      def func():
        import json
        import pyodide.http
        
        with open("data.json") as f:
          data = json.load(f)
          
        ticker = user_input.value.strip().upper()
        
        if ticker in data.keys:
          stock = pyodide.http.open_url("https://iss.moex.com/iss/engines/stock/markets/shares/boards/TQBR/securities/" + ticker +".json")
          #stock = json.loads(requests.get("https://iss.moex.com/iss/engines/stock/markets/shares/boards/TQBR/securities/" + ticker +".json").text)
          price = float(stock["marketdata"]["data"][0][12])
 
        container.write(f"{ticker}: {price}")

      
      
    </py-script>

  </body>
</html>
